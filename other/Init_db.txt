-- Generated by Oracle SQL Developer Data Modeler 18.3.0.268.1208
--   at:        2018-12-09 17:32:55 CET
--   site:      Oracle Database 11g
--   type:      Oracle Database 11g



CREATE TABLE godziny_zajec (
    numer                 INTEGER NOT NULL,
    godzina_rozpoczecia   INTERVAL DAY(0) TO SECOND(0) NOT NULL,
    godzina_zakonczenia   INTERVAL DAY(0) TO SECOND(0) NOT NULL
);

ALTER TABLE godziny_zajec ADD CONSTRAINT godzinyzajec_pk PRIMARY KEY ( numer );

CREATE TABLE grupy_dziekanskie (
    id           INTEGER NOT NULL,
    symbol       VARCHAR2(5 CHAR),
    semestr_id   INTEGER NOT NULL
);

ALTER TABLE grupy_dziekanskie ADD CONSTRAINT grupa_dziekanska_pk PRIMARY KEY ( id );

ALTER TABLE grupy_dziekanskie ADD CONSTRAINT grupa_na_semestr__un UNIQUE ( symbol,
                                                                           semestr_id );

CREATE TABLE kierunki (
    id           INTEGER NOT NULL,
    nazwa        VARCHAR2(15 CHAR),
    wydzial_id   INTEGER NOT NULL
);

ALTER TABLE kierunki ADD CONSTRAINT kierunki_pk PRIMARY KEY ( id );

ALTER TABLE kierunki ADD CONSTRAINT kierunek_na_wydzial_un UNIQUE ( nazwa,
                                                                    wydzial_id );

CREATE TABLE oceny (
    id             INTEGER NOT NULL,
    wartosc        NUMBER(1, 2),
    zajecia_id     INTEGER,
    student_id     VARCHAR2(12 CHAR),
    pracownik_id   VARCHAR2(12 CHAR)
);

ALTER TABLE oceny ADD CONSTRAINT oceny_pk PRIMARY KEY ( id );

CREATE TABLE osoby (
    id         VARCHAR2(12 CHAR) NOT NULL,
    imie       VARCHAR2(20 CHAR) NOT NULL,
    nazwisko   VARCHAR2(40 CHAR) NOT NULL,
    pesel      VARCHAR2(11 CHAR) NOT NULL,
    haslo      VARCHAR2(100 CHAR) NOT NULL,
    typ        VARCHAR2(15 CHAR)
);

ALTER TABLE osoby ADD CONSTRAINT osoba_pk PRIMARY KEY ( id );

ALTER TABLE osoby ADD CONSTRAINT pesel_un UNIQUE ( pesel );

CREATE TABLE pracownicy (
    id          VARCHAR2(12 CHAR) NOT NULL,
    stopien     VARCHAR2(20 CHAR) NOT NULL,
    zespol_id   INTEGER
);

ALTER TABLE pracownicy ADD CONSTRAINT pracownik_pk PRIMARY KEY ( id );

CREATE TABLE przedmioty (
    id           INTEGER NOT NULL,
    nazwa        VARCHAR2(20),
    semestr_id   INTEGER NOT NULL
);

ALTER TABLE przedmioty ADD CONSTRAINT przedmioty_pk PRIMARY KEY ( id );

ALTER TABLE przedmioty ADD CONSTRAINT nazwa_w_sem_un UNIQUE ( nazwa,semestr_id );

CREATE TABLE sale (
    id      INTEGER NOT NULL,
    nazwa   VARCHAR2(20 CHAR) NOT NULL
);

ALTER TABLE sale ADD CONSTRAINT sale_pk PRIMARY KEY ( id );

ALTER TABLE sale ADD CONSTRAINT nazwa_un UNIQUE ( nazwa );

CREATE TABLE semestr (
    id            INTEGER NOT NULL,
    numer         INTEGER,
    rok           INTEGER,
    stopien       INTEGER,
    tryb          VARCHAR2(20 CHAR),
    pora_roku     VARCHAR2(10 CHAR),
    kierunek_id   INTEGER NOT NULL
);

ALTER TABLE semestr ADD CONSTRAINT semestr_pk PRIMARY KEY ( id );

CREATE TABLE studenci (
    id             VARCHAR2(12 CHAR) NOT NULL,
    strona_grupy   VARCHAR2(10 CHAR),
    grupa_id       INTEGER NOT NULL
);

ALTER TABLE studenci ADD CONSTRAINT student_pk PRIMARY KEY ( id );

CREATE TABLE wydzialy (
    id           INTEGER NOT NULL,
    nazwa   VARCHAR2(20 CHAR) NOT NULL,
    skrot   VARCHAR2(7 CHAR) NOT NULL
);

ALTER TABLE wydzialy ADD CONSTRAINT wydzialy_pk PRIMARY KEY ( id );

ALTER TABLE wydzialy ADD CONSTRAINT wydzialy_nazwa_un UNIQUE ( nazwa );
ALTER TABLE wydzialy ADD CONSTRAINT wydzialy_skrot_un UNIQUE ( skrot );

CREATE TABLE zajecia (
    id             INTEGER NOT NULL,
    typ            VARCHAR2(20),
    przedmiot_id   INTEGER NOT NULL
);

ALTER TABLE zajecia ADD CONSTRAINT zajecia_pk PRIMARY KEY ( id );

ALTER TABLE zajecia ADD CONSTRAINT zajecia_na_przedmiot_un UNIQUE ( typ,
                                                                    przedmiot_id );

CREATE TABLE zajecia_w_planie (
    dzien_tygodnia   VARCHAR2(10 CHAR),
    grupa_id         INTEGER NOT NULL,
    zajecia_id       INTEGER NOT NULL,
    godzina_id       INTEGER,
    pracownik_id     VARCHAR2(12 CHAR),
    strona_grupy     VARCHAR2(10 CHAR),
    sala             INTEGER NOT NULL
);

ALTER TABLE zajecia_w_planie
    ADD CONSTRAINT jedne_zaj_na_podgrupe_un UNIQUE ( dzien_tygodnia,
                                                     grupa_id,
                                                     godzina_id,
                                                     strona_grupy );

ALTER TABLE zajecia_w_planie
    ADD CONSTRAINT jedne_zaj_na_sale_un UNIQUE ( dzien_tygodnia,
                                                 godzina_id,
                                                 sala );

CREATE TABLE zespoly (
    id           INTEGER NOT NULL,
    nazwa        VARCHAR2(20 CHAR),
    wydzial_id   INTEGER
);

ALTER TABLE zespoly ADD CONSTRAINT zespoly_pk PRIMARY KEY ( id );

ALTER TABLE zespoly ADD CONSTRAINT zespol_na_wydzial_un UNIQUE ( nazwa,
                                                                 wydzial_id );

ALTER TABLE grupy_dziekanskie
    ADD CONSTRAINT grupa_dziekanska_semestr_fk FOREIGN KEY ( semestr_id )
        REFERENCES semestr ( id );

ALTER TABLE kierunki
    ADD CONSTRAINT kierunki_wydzialy_fk FOREIGN KEY ( wydzial_id )
        REFERENCES wydzialy ( id );

ALTER TABLE oceny
    ADD CONSTRAINT oceny_pracownik_fk FOREIGN KEY ( pracownik_id )
        REFERENCES pracownicy ( id );

ALTER TABLE oceny
    ADD CONSTRAINT oceny_student_fk FOREIGN KEY ( student_id )
        REFERENCES studenci ( id );

ALTER TABLE oceny
    ADD CONSTRAINT oceny_zajecia_fk FOREIGN KEY ( zajecia_id )
        REFERENCES zajecia ( id );

ALTER TABLE pracownicy
    ADD CONSTRAINT pracownik_osoba_fk FOREIGN KEY ( id )
        REFERENCES osoby ( id );

ALTER TABLE pracownicy
    ADD CONSTRAINT pracownik_zespoly_fk FOREIGN KEY ( zespol_id )
        REFERENCES zespoly ( id );

ALTER TABLE przedmioty
    ADD CONSTRAINT przedmioty_semestr_fk FOREIGN KEY ( semestr_id )
        REFERENCES semestr ( id );

ALTER TABLE semestr
    ADD CONSTRAINT semestr_kierunki_fk FOREIGN KEY ( kierunek_id )
        REFERENCES kierunki ( id );

ALTER TABLE studenci
    ADD CONSTRAINT student_grupa_dziekanska_fk FOREIGN KEY ( grupa_id )
        REFERENCES grupy_dziekanskie ( id );

ALTER TABLE studenci
    ADD CONSTRAINT student_osoba_fk FOREIGN KEY ( id )
        REFERENCES osoby ( id );

ALTER TABLE zajecia_w_planie
    ADD CONSTRAINT zaj_w_pl_godz_fk FOREIGN KEY ( godzina_id )
        REFERENCES godziny_zajec ( numer );

ALTER TABLE zajecia_w_planie
    ADD CONSTRAINT zaj_w_pl_gr_dziek_fk FOREIGN KEY ( grupa_id )
        REFERENCES grupy_dziekanskie ( id );

ALTER TABLE zajecia
    ADD CONSTRAINT zajecia_przedmioty_fk FOREIGN KEY ( przedmiot_id )
        REFERENCES przedmioty ( id );

ALTER TABLE zajecia_w_planie
    ADD CONSTRAINT zajecia_w_planie_pracownik_fk FOREIGN KEY ( pracownik_id )
        REFERENCES pracownicy ( id );

ALTER TABLE zajecia_w_planie
    ADD CONSTRAINT zajecia_w_planie_sale_fk FOREIGN KEY ( sala )
        REFERENCES sale ( id );

ALTER TABLE zajecia_w_planie
    ADD CONSTRAINT zajecia_w_planie_zajecia_fk FOREIGN KEY ( zajecia_id )
        REFERENCES zajecia ( id );

ALTER TABLE zespoly
    ADD CONSTRAINT zespoly_wydzialy_fk FOREIGN KEY ( wydzial_id )
        REFERENCES wydzialy ( id );

ALTER TABLE grupy_dziekanskie
    ADD CONSTRAINT grupa_dziekanska_semestr_fk FOREIGN KEY ( semestr_id )
        REFERENCES semestr ( id );

ALTER TABLE kierunki
    ADD CONSTRAINT kierunki_wydzialy_fk FOREIGN KEY ( wydzial_id )
        REFERENCES wydzialy ( id );

ALTER TABLE oceny
    ADD CONSTRAINT oceny_pracownik_fk FOREIGN KEY ( pracownik_id )
        REFERENCES pracownicy ( id );

ALTER TABLE oceny
    ADD CONSTRAINT oceny_student_fk FOREIGN KEY ( student_id )
        REFERENCES studenci ( id );

ALTER TABLE oceny
    ADD CONSTRAINT oceny_zajecia_fk FOREIGN KEY ( zajecia_id )
        REFERENCES zajecia ( id );

ALTER TABLE pracownicy
    ADD CONSTRAINT pracownik_osoba_fk FOREIGN KEY ( id )
        REFERENCES osoby ( id );

ALTER TABLE pracownicy
    ADD CONSTRAINT pracownik_zespoly_fk FOREIGN KEY ( zespol_id )
        REFERENCES zespoly ( id );

ALTER TABLE przedmioty
    ADD CONSTRAINT przedmioty_semestr_fk FOREIGN KEY ( semestr_id )
        REFERENCES semestr ( id );

ALTER TABLE semestr
    ADD CONSTRAINT semestr_kierunki_fk FOREIGN KEY ( kierunek_id )
        REFERENCES kierunki ( id );

ALTER TABLE studenci
    ADD CONSTRAINT student_grupa_dziekanska_fk FOREIGN KEY ( grupa_id )
        REFERENCES grupy_dziekanskie ( id );

ALTER TABLE studenci
    ADD CONSTRAINT student_osoba_fk FOREIGN KEY ( id )
        REFERENCES osoby ( id );

ALTER TABLE zajecia_w_planie
    ADD CONSTRAINT zaj_w_pl_godz_fk FOREIGN KEY ( godzina_id )
        REFERENCES godziny_zajec ( numer );

ALTER TABLE zajecia_w_planie
    ADD CONSTRAINT zaj_w_pl_gr_dziek_fk FOREIGN KEY ( grupa_id )
        REFERENCES grupy_dziekanskie ( id );

ALTER TABLE zajecia
    ADD CONSTRAINT zajecia_przedmioty_fk FOREIGN KEY ( przedmiot_id )
        REFERENCES przedmioty ( id );

ALTER TABLE zajecia_w_planie
    ADD CONSTRAINT zajecia_w_planie_pracownik_fk FOREIGN KEY ( pracownik_id )
        REFERENCES pracownicy ( id );

ALTER TABLE zajecia_w_planie
    ADD CONSTRAINT zajecia_w_planie_sale_fk FOREIGN KEY ( sala )
        REFERENCES sale ( id );

ALTER TABLE zajecia_w_planie
    ADD CONSTRAINT zajecia_w_planie_zajecia_fk FOREIGN KEY ( zajecia_id )
        REFERENCES zajecia ( id );

ALTER TABLE zespoly
    ADD CONSTRAINT zespoly_wydzialy_fk FOREIGN KEY ( wydzial_id )
        REFERENCES wydzialy ( skrot );

CREATE OR REPLACE TRIGGER arc_fkarc_1_studenci BEFORE
    INSERT OR UPDATE OF id ON studenci
    FOR EACH ROW
DECLARE
    d   VARCHAR2(15 CHAR);
BEGIN
    SELECT
        a.typ
    INTO d
    FROM
        osoby a
    WHERE
        a.id = :new.id;

    IF ( d IS NULL OR d <> 'Student' ) THEN
        raise_application_error(-20223, 'FK Student_Osoba_FK in Table Studenci violates Arc constraint on Table Osoby - discriminator column Typ doesn''t have value ''Student'''
        );
    END IF;

EXCEPTION
    WHEN no_data_found THEN
        NULL;
    WHEN OTHERS THEN
        RAISE;
END;
/

CREATE OR REPLACE TRIGGER arc_fkarc_1_pracownicy BEFORE
    INSERT OR UPDATE OF id ON pracownicy
    FOR EACH ROW
DECLARE
    d   VARCHAR2(15 CHAR);
BEGIN
    SELECT
        a.typ
    INTO d
    FROM
        osoby a
    WHERE
        a.id = :new.id;

    IF ( d IS NULL OR d <> 'Teacher' ) THEN
        raise_application_error(-20223, 'FK Pracownik_Osoba_FK in Table Pracownicy violates Arc constraint on Table Osoby - discriminator column Typ doesn''t have value ''Teacher'''
        );
    END IF;

EXCEPTION
    WHEN no_data_found THEN
        NULL;
    WHEN OTHERS THEN
        RAISE;
END;
/

CREATE SEQUENCE seq_grupy START WITH 1 NOCACHE ORDER;

CREATE OR REPLACE TRIGGER grupy_dziekanskie_id_trg BEFORE
    INSERT ON grupy_dziekanskie
    FOR EACH ROW
    WHEN ( new.id IS NULL )
BEGIN
    :new.id := seq_grupy.nextval;
END;
/

CREATE SEQUENCE seq_oceny START WITH 1 NOCACHE ORDER;

CREATE OR REPLACE TRIGGER oceny_id_trg BEFORE
    INSERT ON oceny
    FOR EACH ROW
    WHEN ( new.id IS NULL )
BEGIN
    :new.id := seq_oceny.nextval;
END;
/

CREATE SEQUENCE seq_przedmioty START WITH 1 NOCACHE ORDER;

CREATE OR REPLACE TRIGGER przedmioty_id_trg BEFORE
    INSERT ON przedmioty
    FOR EACH ROW
    WHEN ( new.id IS NULL )
BEGIN
    :new.id := seq_przedmioty.nextval;
END;
/

CREATE SEQUENCE seq_semestry START WITH 1 NOCACHE ORDER;

CREATE OR REPLACE TRIGGER semestr_id_trg BEFORE
    INSERT ON semestr
    FOR EACH ROW
    WHEN ( new.id IS NULL )
BEGIN
    :new.id := seq_semestry.nextval;
END;
/

CREATE SEQUENCE seq_zajecia START WITH 1 NOCACHE ORDER;

CREATE OR REPLACE TRIGGER zajecia_id_trg BEFORE
    INSERT ON zajecia
    FOR EACH ROW
    WHEN ( new.id IS NULL )
BEGIN
    :new.id := seq_zajecia.nextval;
END;
/

CREATE SEQUENCE seq_zespoly START WITH 1 NOCACHE ORDER;

CREATE OR REPLACE TRIGGER zespoly_id_trg BEFORE
    INSERT ON zespoly
    FOR EACH ROW
    WHEN ( new.id IS NULL )
BEGIN
SELECT seq_zespoly.nextval INTO :new.id 
   FROM dual;
END;
/
-- ARTUR
-- wydzialy
CREATE SEQUENCE seq_wydz START WITH 1 NOCACHE ORDER;
CREATE OR REPLACE TRIGGER wydz_id_trg BEFORE
    INSERT ON wydzialy
    FOR EACH ROW
    WHEN ( new.id IS NULL )
BEGIN
    :new.id := seq_wydz.nextval;
END;
/
insert into wydzialy(nazwa,skrot) values('Informatyki','WI');

/
-- godziny
insert into godziny_zajec(numer, godzina_rozpoczecia,godzina_zakonczenia) values(1, interval '0 08:00:00' day(0) to second, interval '0 09:30:00' day(0) to second);
insert into godziny_zajec(numer, godzina_rozpoczecia,godzina_zakonczenia) values(2, interval '0 09:45:00' day(0) to second, interval '0 11:15:00' day(0) to second);
insert into godziny_zajec(numer, godzina_rozpoczecia,godzina_zakonczenia) values(3, interval '0 11:45:00' day(0) to second, interval '0 13:15:00' day(0) to second);
insert into godziny_zajec(numer, godzina_rozpoczecia,godzina_zakonczenia) values(4, interval '0 13:30:00' day(0) to second, interval '0 15:00:00' day(0) to second);
insert into godziny_zajec(numer, godzina_rozpoczecia,godzina_zakonczenia) values(5, interval '0 15:10:00' day(0) to second, interval '0 16:40:00' day(0) to second);
insert into godziny_zajec(numer, godzina_rozpoczecia,godzina_zakonczenia) values(6, interval '0 16:50:00' day(0) to second, interval '0 18:20:00' day(0) to second);
insert into godziny_zajec(numer, godzina_rozpoczecia,godzina_zakonczenia) values(7, interval '0 18:30:00' day(0) to second, interval '0 20:00:00' day(0) to second);
insert into godziny_zajec(numer, godzina_rozpoczecia,godzina_zakonczenia) values(8, interval '0 20:10:00' day(0) to second, interval '0 21:40:00' day(0) to second);
ALTER TABLE godziny_zajec SET UNUSED (godzina_rozpoczecia, godzina_zakonczenia);
ALTER TABLE godziny_zajec DROP UNUSED COLUMNS;

ALTER TABLE godziny_zajec
  ADD godz_roz number(2,0);

ALTER TABLE godziny_zajec
  ADD min_roz number(2,0);

ALTER TABLE godziny_zajec
  ADD godz_zak number(2,0);

ALTER TABLE godziny_zajec
  ADD min_zak number(2,0);

  update godziny_zajec
  set
  godz_roz=8,
  min_roz=0,
  godz_zak=9,
  min_zak=30
  where
  numer=1;
  update godziny_zajec
  set
  godz_roz=9,
  min_roz=45,
  godz_zak=11,
  min_zak=15
  where
  numer=2;
  update godziny_zajec
  set
  godz_roz=11,
  min_roz=45,
  godz_zak=13,
  min_zak=15
  where
  numer=3;
  update godziny_zajec
  set
  godz_roz=13,
  min_roz=30,
  godz_zak=15,
  min_zak=0
  where
  numer=4;
  update godziny_zajec
  set
  godz_roz=15,
  min_roz=10,
  godz_zak=16,
  min_zak=40
  where
  numer=5;
  update godziny_zajec
  set
  godz_roz=16,
  min_roz=50,
  godz_zak=18,
  min_zak=20
  where
  numer=6;
  update godziny_zajec
  set
  godz_roz=18,
  min_roz=30,
  godz_zak=20,
  min_zak=0
  where
  numer=7;
  update godziny_zajec
  set
  godz_roz=20,
  min_roz=10,
  godz_zak=21,
  min_zak=40
  where
  numer=8;
/
-- zespoly
insert into zespoly (NAZWA,wydzial_ID) values ('ADMINISTRACJA',(select id from wydzialy where skrot='WI'));
insert into zespoly (NAZWA,wydzial_ID) values ('SYSTEMY ROZPROSZONE',(select id from wydzialy where skrot='WI'));
insert into zespoly (NAZWA,wydzial_ID) values ('SYSTEMY EKSPERCKIE',(select id from wydzialy where skrot='WI'));
insert into zespoly (NAZWA,wydzial_ID) values ('ALGORYTMY',(select id from wydzialy where skrot='WI'));
insert into zespoly (NAZWA,wydzial_ID) values ('BADANIA OPERACYJNE',(select id from wydzialy where skrot='WI'));
/

-- kierunki
CREATE SEQUENCE seq_kierunki START WITH 1 NOCACHE ORDER;
CREATE OR REPLACE TRIGGER kierunki_id_trg BEFORE
    INSERT ON kierunki
    FOR EACH ROW
    WHEN ( new.id IS NULL )
BEGIN
    :new.id := seq_kierunki.nextval;
END;
/
insert into kierunki(nazwa,wydzial_id) values('Informatyka',(select id from wydzialy where skrot='WI'));
    

-- semestry
rename semestr to semestry;
insert into semestry 
(numer,rok,stopien,tryb,pora_roku,kierunek_ID)
values
(1,1,1,'stacjonarne','zimowy',(select id from kierunki where nazwa = 'Informatyka' and wydzial_id=(select id from wydzialy where skrot='WI')));
insert into semestry 
(numer,rok, stopien,tryb,pora_roku,kierunek_ID)
values
(2,1,1,'stacjonarne','zimowy',(select id from kierunki where nazwa = 'Informatyka' and wydzial_id=(select id from wydzialy where skrot='WI')));
insert into semestry 
(numer,rok, stopien,tryb,pora_roku,kierunek_ID)
values
(3,2,1,'stacjonarne','zimowy',(select id from kierunki where nazwa = 'Informatyka' and wydzial_id=(select id from wydzialy where skrot='WI')));
insert into semestry 
(numer,rok, stopien,tryb,pora_roku,kierunek_ID)
values
(4,2,1,'stacjonarne','zimowy',(select id from kierunki where nazwa = 'Informatyka' and wydzial_id=(select id from wydzialy where skrot='WI')));
insert into semestry 
(numer,rok, stopien,tryb,pora_roku,kierunek_ID)
values
(5,3,1,'stacjonarne','zimowy',(select id from kierunki where nazwa = 'Informatyka' and wydzial_id=(select id from wydzialy where skrot='WI')));
insert into semestry 
(numer,rok, stopien,tryb,pora_roku,kierunek_ID)
values
(6,3,1,'stacjonarne','zimowy',(select id from kierunki where nazwa = 'Informatyka' and wydzial_id=(select id from wydzialy where skrot='WI')));
insert into semestry 
(numer,rok, stopien,tryb,pora_roku,kierunek_ID)
values
(7,4,1,'stacjonarne','zimowy',(select id from kierunki where nazwa = 'Informatyka' and wydzial_id=(select id from wydzialy where skrot='WI')));
update semestry set pora_roku='letni' where numer in (2,4,6);

-- grupy
insert into grupy_dziekanskie(symbol,semestr_id) values('I1', (select id from semestry where numer=1));
insert into grupy_dziekanskie(symbol,semestr_id) values('I1', (select id from semestry where numer=2));
insert into grupy_dziekanskie(symbol,semestr_id) values('I1', (select id from semestry where numer=3));
insert into grupy_dziekanskie(symbol,semestr_id) values('I1', (select id from semestry where numer=4));
insert into grupy_dziekanskie(symbol,semestr_id) values('I1', (select id from semestry where numer=5));
insert into grupy_dziekanskie(symbol,semestr_id) values('I1', (select id from semestry where numer=6));
insert into grupy_dziekanskie(symbol,semestr_id) values('I1', (select id from semestry where numer=7));
insert into grupy_dziekanskie(symbol,semestr_id) values('I2', (select id from semestry where numer=1));
insert into grupy_dziekanskie(symbol,semestr_id) values('I2', (select id from semestry where numer=2));
insert into grupy_dziekanskie(symbol,semestr_id) values('I2', (select id from semestry where numer=3));
insert into grupy_dziekanskie(symbol,semestr_id) values('I2', (select id from semestry where numer=4));
insert into grupy_dziekanskie(symbol,semestr_id) values('I2', (select id from semestry where numer=5));
insert into grupy_dziekanskie(symbol,semestr_id) values('I2', (select id from semestry where numer=6));
insert into grupy_dziekanskie(symbol,semestr_id) values('I2', (select id from semestry where numer=7));
insert into grupy_dziekanskie(symbol,semestr_id) values('I3', (select id from semestry where numer=1));
insert into grupy_dziekanskie(symbol,semestr_id) values('I3', (select id from semestry where numer=2));
insert into grupy_dziekanskie(symbol,semestr_id) values('I3', (select id from semestry where numer=3));
insert into grupy_dziekanskie(symbol,semestr_id) values('I3', (select id from semestry where numer=4));
insert into grupy_dziekanskie(symbol,semestr_id) values('I3', (select id from semestry where numer=5));
insert into grupy_dziekanskie(symbol,semestr_id) values('I3', (select id from semestry where numer=6));
insert into grupy_dziekanskie(symbol,semestr_id) values('I3', (select id from semestry where numer=7));
insert into grupy_dziekanskie(symbol,semestr_id) values('I4', (select id from semestry where numer=1));
insert into grupy_dziekanskie(symbol,semestr_id) values('I4', (select id from semestry where numer=2));
insert into grupy_dziekanskie(symbol,semestr_id) values('I4', (select id from semestry where numer=3));
insert into grupy_dziekanskie(symbol,semestr_id) values('I4', (select id from semestry where numer=4));
insert into grupy_dziekanskie(symbol,semestr_id) values('I4', (select id from semestry where numer=5));
insert into grupy_dziekanskie(symbol,semestr_id) values('I4', (select id from semestry where numer=6));
insert into grupy_dziekanskie(symbol,semestr_id) values('I4', (select id from semestry where numer=7));
insert into grupy_dziekanskie(symbol,semestr_id) values('I5', (select id from semestry where numer=1));
insert into grupy_dziekanskie(symbol,semestr_id) values('I5', (select id from semestry where numer=2));
insert into grupy_dziekanskie(symbol,semestr_id) values('I5', (select id from semestry where numer=3));
insert into grupy_dziekanskie(symbol,semestr_id) values('I5', (select id from semestry where numer=4));
insert into grupy_dziekanskie(symbol,semestr_id) values('I5', (select id from semestry where numer=5));
insert into grupy_dziekanskie(symbol,semestr_id) values('I5', (select id from semestry where numer=6));
insert into grupy_dziekanskie(symbol,semestr_id) values('I5', (select id from semestry where numer=7));
insert into grupy_dziekanskie(symbol,semestr_id) values('I6', (select id from semestry where numer=1));
insert into grupy_dziekanskie(symbol,semestr_id) values('I6', (select id from semestry where numer=2));
insert into grupy_dziekanskie(symbol,semestr_id) values('I6', (select id from semestry where numer=3));
insert into grupy_dziekanskie(symbol,semestr_id) values('I6', (select id from semestry where numer=4));
create SYNONYM grupy for grupy_dziekanskie;


-- sale
CREATE SEQUENCE seq_sale START WITH 1 NOCACHE ORDER;
CREATE OR REPLACE TRIGGER sale_id_trg BEFORE
    INSERT ON sale
    FOR EACH ROW
    WHEN ( new.id IS NULL )
BEGIN
    :new.id := seq_sale.nextval;
END;
/
insert into sale(nazwa) values('2 CW');
insert into sale(nazwa) values('8 CW');
insert into sale(nazwa) values('L053 BT');
insert into sale(nazwa) values('lab. 1.6.16');
insert into sale(nazwa) values('lab. 1.6.18');
insert into sale(nazwa) values('lab. 1.6.21');
insert into sale(nazwa) values('lab. 1.6.22');
insert into sale(nazwa) values('lab. 1.6.23');
insert into sale(nazwa) values('lab. 43');
insert into sale(nazwa) values('lab. 44');
insert into sale(nazwa) values('lab. 45');
insert into sale(nazwa) values('lab. 143');
insert into sale(nazwa) values('lab. 2.7.14');
insert into sale(nazwa) values('lab. 2.7.15');
insert into sale(nazwa) values('lab. 2.7.16');
insert into sale(nazwa) values('lab. P6');

-- przedmioty
ALTER TABLE przedmioty MODIFY (NAZWA VARCHAR2(50 CHAR));
ALTER TABLE przedmioty
  ADD ects number(3,0) not null;
  insert into przedmioty(nazwa,semestr_id,ects) values('Sieci komputerowe 2',(select id from semestry where numer=5),5);
insert into przedmioty(nazwa,semestr_id,ects) values('Systemy zarządzania bazami danych',(select id from semestry where numer=5),5);
insert into przedmioty(nazwa,semestr_id,ects) values('Wspomaganie decyzji',(select id from semestry where numer=5),5);
insert into przedmioty(nazwa,semestr_id,ects) values('Inżynieria Oprogramowania',(select id from semestry where numer=5),3);
insert into przedmioty(nazwa,semestr_id,ects) values('Komunikacja człowiek-komputer',(select id from semestry where numer=5),3);
insert into przedmioty(nazwa,semestr_id,ects) values('Sztuczna Inteligencja',(select id from semestry where numer=5),4);
insert into przedmioty(nazwa,semestr_id,ects) values('Systemy wbudowane',(select id from semestry where numer=5),5);

-- zajecia
insert into zajecia(typ,przedmiot_id) values('l',(select id from przedmioty where nazwa='Sieci komputerowe 2'));
insert into zajecia(typ,przedmiot_id) values('w',(select id from przedmioty where nazwa='Sieci komputerowe 2'));
insert into zajecia(typ,przedmiot_id) values('l',(select id from przedmioty where nazwa='Systemy zarządzania bazami danych'));
insert into zajecia(typ,przedmiot_id) values('w',(select id from przedmioty where nazwa='Systemy zarządzania bazami danych'));
insert into zajecia(typ,przedmiot_id) values('l',(select id from przedmioty where nazwa='Wspomaganie decyzji'));
insert into zajecia(typ,przedmiot_id) values('w',(select id from przedmioty where nazwa='Wspomaganie decyzji'));
insert into zajecia(typ,przedmiot_id) values('l',(select id from przedmioty where nazwa='Inżynieria Oprogramowania'));
insert into zajecia(typ,przedmiot_id) values('w',(select id from przedmioty where nazwa='Inżynieria Oprogramowania'));
insert into zajecia(typ,przedmiot_id) values('l',(select id from przedmioty where nazwa='Komunikacja człowiek-komputer'));
insert into zajecia(typ,przedmiot_id) values('w',(select id from przedmioty where nazwa='Komunikacja człowiek-komputer'));
insert into zajecia(typ,przedmiot_id) values('l',(select id from przedmioty where nazwa='Sztuczna Inteligencja'));
insert into zajecia(typ,przedmiot_id) values('w',(select id from przedmioty where nazwa='Sztuczna Inteligencja'));
insert into zajecia(typ,przedmiot_id) values('l',(select id from przedmioty where nazwa='Systemy wbudowane'));
insert into zajecia(typ,przedmiot_id) values('w',(select id from przedmioty where nazwa='Systemy wbudowane'));

-- osoby
CREATE SEQUENCE seq_pracownicy START WITH 1 NOCACHE ORDER;
CREATE SEQUENCE seq_studenci START WITH 1500 NOCACHE ORDER;

CREATE OR REPLACE TRIGGER osoby_id_trg BEFORE
    INSERT ON osoby
    FOR EACH ROW
    WHEN ( new.id IS NULL )
BEGIN
  IF :new.typ = 'Student' THEN 
      :new.id := seq_studenci.nextval;
  END IF;
  IF :new.typ = 'Teacher' THEN 
      :new.id := seq_pracownicy.nextval;
  END IF;
END;
/

-- pracownicy 5 sem
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Bartosz','Zagrzeba','11111111111','Zagrzeba','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111111'),'dr inż.',(select id from zespoly where nazwa='SYSTEMY EKSPERCKIE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Roman','Słowiński','11111111112','Słowiński','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111112'),'prof. dr hab. inż.',(select id from zespoly where nazwa='SYSTEMY ROZPROSZONE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Piotr','Zielniewicz','11111111113','Zielniewicz','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111113'),'dr hab. inż.',(select id from zespoly where nazwa='BADANIA OPERACYJNE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Paweł','Boiński','11111111114','Boiński','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111114'),'dr inż.',(select id from zespoly where nazwa='ADMINISTRACJA'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Michał','Tomczyk','11111111115','Tomczyk','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111115'),'dr inż.',(select id from zespoly where nazwa='SYSTEMY EKSPERCKIE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Jan','Kończak','11111111116','Kończak','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111116'),'dr inż.',(select id from zespoly where nazwa='SYSTEMY EKSPERCKIE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Marcin','Szeląg','11111111117','Szeląg','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111117'),'dr inż.',(select id from zespoly where nazwa='ALGORYTMY'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Mirosław','Ochodek','11111111118','Ochodek','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111118'),'dr inż.',(select id from zespoly where nazwa='SYSTEMY EKSPERCKIE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Ariel','Antonowicz','11111111119','Antonowicz','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111119'),'dr inż.',(select id from zespoly where nazwa='SYSTEMY EKSPERCKIE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Michał','Maćkowiak','11111111120','Maćkowiak','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111120'),'dr inż.',(select id from zespoly where nazwa='ADMINISTRACJA'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Agnieszka','Ławrynowicz','11111111121','Ławrynowicz','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111121'),'dr inż.',(select id from zespoly where nazwa='SYSTEMY ROZPROSZONE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Bartosz','Bębel','11111111122','Bębel','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111122'),'dr inż.',(select id from zespoly where nazwa='SYSTEMY ROZPROSZONE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Przemysław','Zakrzewski','11111111123','Zakrzewski','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111123'),'dr inż.',(select id from zespoly where nazwa='ADMINISTRACJA'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Michał','Kalewski','11111111124','Kalewski','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111124'),'dr inż.',(select id from zespoly where nazwa='BADANIA OPERACYJNE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Marek','Wojciehowski','11111111125','Wojciehowski','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111125'),'dr inż.',(select id from zespoly where nazwa='SYSTEMY ROZPROSZONE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Wojciech','Complak','11111111126','Complak','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111126'),'dr inż.',(select id from zespoly where nazwa='BADANIA OPERACYJNE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Michał','Boroń','11111111127','Boroń','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111127'),'dr inż.',(select id from zespoly where nazwa='SYSTEMY ROZPROSZONE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Artur','Michalski','11111111128','Michalski','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111128'),'dr inż.',(select id from zespoly where nazwa='BADANIA OPERACYJNE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Michal','Sajkowski','11111111129','Sajkowski','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111129'),'dr inż.',(select id from zespoly where nazwa='BADANIA OPERACYJNE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Miłosz','Kadziński','11111111130','Kadziński','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111130'),'dr inż.',(select id from zespoly where nazwa='BADANIA OPERACYJNE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Irmina','Masłowska','11111111131','Masłowska','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111131'),'dr inż.',(select id from zespoly where nazwa='SYSTEMY EKSPERCKIE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Anna','Leśniewska','11111111132','Leśniewska','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111132'),'dr inż.',(select id from zespoly where nazwa='SYSTEMY EKSPERCKIE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Jerzy','Błaszczyński','11111111133','Błaszczyński','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111133'),'dr inż.',(select id from zespoly where nazwa='SYSTEMY EKSPERCKIE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Tadeusz','Morzy','11111111134','Morzy','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111134'),'prof. dr hab. inż.',(select id from zespoly where nazwa='SYSTEMY ROZPROSZONE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Tadeusz','Koszlajda','11111111135','Koszlajda','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111135'),'dr inż.',(select id from zespoly where nazwa='BADANIA OPERACYJNE'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Paweł','Liskowski','11111111136','Liskowski','Teacher');
insert into pracownicy(id,stopien,zespol_id) values((select id from osoby where pesel='11111111136'),'dr inż.',(select id from zespoly where nazwa='SYSTEMY EKSPERCKIE'));

-- studenci

insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Artur','Mostowski','97030901234','Mostowski','Student');
insert into studenci(id,strona_grupy,grupa_id) values((select id from osoby where pesel='97030901234'),'lewa',(select id from grupy_dziekanskie where semestr_id=5 and symbol='I1'));
insert into osoby(imie,nazwisko,pesel,haslo,typ) values('Łukasz','Grygier','97032101234','Grygier','Student');
insert into studenci(id,strona_grupy,grupa_id) values((select id from osoby where pesel='97032101234'),'lewa',(select id from grupy_dziekanskie where semestr_id=5 and symbol='I1'));



-- zajecia w planie
ALTER TABLE zajecia_w_planie MODIFY (dzien_tygodnia NUMBER(38,0));

insert into zajecia_w_planie(dzien_tygodnia,grupa_id,zajecia_id,godzina_id,pracownik_id,strona_grupy,sala) values(1,(select id from grupy_dziekanskie where symbol='I1' and semestr_id=(select id from semestry where NUMER=5)),(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Wspomaganie decyzji')),2,(select id from osoby where nazwisko='Słowiński'),'lewa',(select id from sale where nazwa='8 CW'));
insert into zajecia_w_planie(dzien_tygodnia,grupa_id,zajecia_id,godzina_id,pracownik_id,strona_grupy,sala) values(1,(select id from grupy_dziekanskie where symbol='I1' and semestr_id=(select id from semestry where NUMER=5)),(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Komunikacja człowiek-komputer')),3,(select id from osoby where nazwisko='Zielniewicz'),'lewa',(select id from sale where nazwa='L053 BT'));
insert into zajecia_w_planie(dzien_tygodnia,grupa_id,zajecia_id,godzina_id,pracownik_id,strona_grupy,sala) values(2,(select id from grupy_dziekanskie where symbol='I1' and semestr_id=(select id from semestry where NUMER=5)),(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Komunikacja człowiek-komputer')),1,(select id from osoby where nazwisko='Tomczyk'),'lewa',(select id from sale where nazwa='lab. 45'));
insert into zajecia_w_planie(dzien_tygodnia,grupa_id,zajecia_id,godzina_id,pracownik_id,strona_grupy,sala) values(2,(select id from grupy_dziekanskie where symbol='I1' and semestr_id=(select id from semestry where NUMER=5)),(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Systemy wbudowane')),2,(select id from osoby where nazwisko='Antonowicz'),'lewa',(select id from sale where nazwa='lab. 2.7.14'));
insert into zajecia_w_planie(dzien_tygodnia,grupa_id,zajecia_id,godzina_id,pracownik_id,strona_grupy,sala) values(2,(select id from grupy_dziekanskie where symbol='I1' and semestr_id=(select id from semestry where NUMER=5)),(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Sztuczna Inteligencja')),4,(select id from osoby where nazwisko='Ławrynowicz'),'lewa',(select id from sale where nazwa='lab. 43'));
insert into zajecia_w_planie(dzien_tygodnia,grupa_id,zajecia_id,godzina_id,pracownik_id,strona_grupy,sala) values(2,(select id from grupy_dziekanskie where symbol='I1' and semestr_id=(select id from semestry where NUMER=5)),(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Inżynieria Oprogramowania')),5,(select id from osoby where nazwisko='Maćkowiak'),'lewa',(select id from sale where nazwa='lab. 43'));
insert into zajecia_w_planie(dzien_tygodnia,grupa_id,zajecia_id,godzina_id,pracownik_id,strona_grupy,sala) values(3,(select id from grupy_dziekanskie where symbol='I1' and semestr_id=(select id from semestry where NUMER=5)),(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Sieci komputerowe 2')),2,(select id from osoby where nazwisko='Boroń'),'lewa',(select id from sale where nazwa='lab. 1.6.18'));
insert into zajecia_w_planie(dzien_tygodnia,grupa_id,zajecia_id,godzina_id,pracownik_id,strona_grupy,sala) values(3,(select id from grupy_dziekanskie where symbol='I1' and semestr_id=(select id from semestry where NUMER=5)),(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Sztuczna Inteligencja')),3,(select id from osoby where nazwisko='Michalski'),'lewa',(select id from sale where nazwa='L053 BT'));
insert into zajecia_w_planie(dzien_tygodnia,grupa_id,zajecia_id,godzina_id,pracownik_id,strona_grupy,sala) values(3,(select id from grupy_dziekanskie where symbol='I1' and semestr_id=(select id from semestry where NUMER=5)),(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Inżynieria Oprogramowania')),4,(select id from osoby where nazwisko='Ochodek'),'lewa',(select id from sale where nazwa='2 CW'));
insert into zajecia_w_planie(dzien_tygodnia,grupa_id,zajecia_id,godzina_id,pracownik_id,strona_grupy,sala) values(3,(select id from grupy_dziekanskie where symbol='I1' and semestr_id=(select id from semestry where NUMER=5)),(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Sieci komputerowe 2')),5,(select id from osoby where nazwisko='Sajkowski'),'lewa',(select id from sale where nazwa='8 CW'));
insert into zajecia_w_planie(dzien_tygodnia,grupa_id,zajecia_id,godzina_id,pracownik_id,strona_grupy,sala) values(4,(select id from grupy_dziekanskie where symbol='I1' and semestr_id=(select id from semestry where NUMER=5)),(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Wspomaganie decyzji')),1,(select id from osoby where nazwisko='Masłowska'),'lewa',(select id from sale where nazwa='lab. 43'));
insert into zajecia_w_planie(dzien_tygodnia,grupa_id,zajecia_id,godzina_id,pracownik_id,strona_grupy,sala) values(4,(select id from grupy_dziekanskie where symbol='I1' and semestr_id=(select id from semestry where NUMER=5)),(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Systemy zarządzania bazami danych')),2,(select id from osoby where nazwisko='Leśniewska'),'lewa',(select id from sale where nazwa='lab. 1.6.22'));
insert into zajecia_w_planie(dzien_tygodnia,grupa_id,zajecia_id,godzina_id,pracownik_id,strona_grupy,sala) values(4,(select id from grupy_dziekanskie where symbol='I1' and semestr_id=(select id from semestry where NUMER=5)),(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Systemy zarządzania bazami danych')),3,(select id from osoby where nazwisko='Morzy'),'lewa',(select id from sale where nazwa='8 CW'));
insert into zajecia_w_planie(dzien_tygodnia,grupa_id,zajecia_id,godzina_id,pracownik_id,strona_grupy,sala) values(4,(select id from grupy_dziekanskie where symbol='I1' and semestr_id=(select id from semestry where NUMER=5)),(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Systemy wbudowane')),5,(select id from osoby where nazwisko='Zakrzewski'),'lewa',(select id from sale where nazwa='8 CW'));

ALTER TABLE zajecia_w_planie
DROP CONSTRAINT JEDNE_ZAJ_NA_SALE_UN;
-- oceny
ALTER TABLE oceny
  MODIFY wartosc number(2,1);
  /
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(3.5,(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Sieci komputerowe 2')),'1500','16');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(4.5,(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Sieci komputerowe 2')),'1500','4');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(2.0,(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Systemy zarządzania bazami danych')),'1500','3');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(3.0,(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Systemy zarządzania bazami danych')),'1500','3');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(3.5,(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Wspomaganie decyzji')),'1500','2');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(3.5,(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Wspomaganie decyzji')),'1500','7');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(3.0,(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Inżynieria Oprogramowania')),'1500','13');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(3.0,(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Inżynieria Oprogramowania')),'1500','18');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(3.5,(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Komunikacja człowiek-komputer')),'1500','4');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(5.0,(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Komunikacja człowiek-komputer')),'1500','13');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(4.5,(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Sztuczna Inteligencja')),'1500','24');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(2.0,(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Sztuczna Inteligencja')),'1500','8');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(4.0,(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Systemy wbudowane')),'1500','1');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(4.5,(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Systemy wbudowane')),'1500','0');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(5.0,(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Sieci komputerowe 2')),'1501','24');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(4.5,(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Sieci komputerowe 2')),'1501','4');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(4.5,(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Systemy zarządzania bazami danych')),'1501','25');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(3.5,(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Systemy zarządzania bazami danych')),'1501','15');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(5.0,(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Wspomaganie decyzji')),'1501','19');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(3.0,(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Wspomaganie decyzji')),'1501','9');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(4.5,(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Inżynieria Oprogramowania')),'1501','13');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(3.0,(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Inżynieria Oprogramowania')),'1501','16');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(3.0,(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Komunikacja człowiek-komputer')),'1501','22');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(5.0,(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Komunikacja człowiek-komputer')),'1501','8');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(3.0,(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Sztuczna Inteligencja')),'1501','18');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(3.5,(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Sztuczna Inteligencja')),'1501','8');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(2.0,(select id from zajecia where typ='l' and przedmiot_id=(select id from przedmioty where nazwa='Systemy wbudowane')),'1501','13');
insert into oceny(wartosc,zajecia_id,student_id,pracownik_id) values(4.5,(select id from zajecia where typ='w' and przedmiot_id=(select id from przedmioty where nazwa='Systemy wbudowane')),'1501','24');
-- perspektywy
create or replace view GrupyCat as
SELECT semestr_id, listagg(symbol,', ') within group (order by symbol) as grupy
FROM  grupy_dziekanskie g group by semestr_id;

create or replace view PrzedmiotyCat as
SELECT semestr_id, listagg(nazwa,', ') within group (order by nazwa) as przedmioty
FROM  przedmioty g group by semestr_id;

create or replace view Plan_Zajec as
WITH
rzecz(dzien,godz,sym,strona,id,sem)
AS (select dzien,godz,g.symbol as sym,strona,g.id,g.semestr_id as sem from (select rownum dzien from dual connect by level <= 7),(select rownum godz  from dual connect by level <=(select count(*) from godziny_zajec)),grupy_dziekanskie g,(select 'lewa' as strona from dual union select 'prawa' from dual))
select dzien,godz,sym,strona,sem,o.imie,o.nazwisko,p.stopien,prz.nazwa as przedmiot,zaj.typ,s.nazwa as sala from rzecz a
left join zajecia_w_planie z on (a.dzien=z.dzien_tygodnia and a.godz=z.godzina_id and a.id=z.grupa_id and a.strona=z.strona_grupy)
left join pracownicy p on p.id=z.pracownik_id
left join osoby o on o.id=z.pracownik_id
left join zajecia zaj on zaj.id=z.zajecia_id
left join przedmioty prz on zaj.przedmiot_id=prz.id
left join sale s on z.sala=s.id
order by dzien,godz,sym,strona
;
/
CREATE OR REPLACE Function Srednia
   ( sid in VARCHAR2,
    sem in number
    )
   RETURN number
IS
   suma number(6,1);
    sumaECTS number(6,1);
   cursor c1 is
    SELECT p.nazwa,p.ects,o.wartosc,op.imie,op.nazwisko,pr.stopien,(select count(*) from zajecia where przedmiot_id=p.id)
    from oceny o
    inner join zajecia z on z.id=o.zajecia_id
    inner join przedmioty p on p.id=z.przedmiot_id
    inner join osoby op on op.id =o.pracownik_id
    inner join pracownicy
    pr on pr.id=op.id where zajecia_id in (select id from zajecia where przedmiot_id in (select id from przedmioty where semestr_id=sem)) and student_id=sid order by p.nazwa,z.typ;

BEGIN
   suma := 0;
   sumaECTS := 0;
   FOR row in c1
   LOOP
        suma := suma + row.wartosc*row.ECTS;
        sumaECTS := sumaECTS+ row.ECTS;
   END LOOP;
   IF sumaECTS>0 THEN
   RETURN suma/sumaECTS;
    ELSE
       RETURN 0;
    END IF;
END;
/
CREATE or replace PROCEDURE usunOcene (sid studenci.id%type, zaj zajecia.id%type) as
   BEGIN
      DELETE FROM oceny
      WHERE
      student_id=sid
      and zajecia_id=zaj;
   END;
/
CREATE or replace PROCEDURE usunosobe (sid studenci.id%type) as
   BEGIN
        FOR c IN (SELECT student_id, zajecia_id FROM oceny where student_id=sid) LOOP
           usunocene(c.student_id, c.zajecia_id);
        END LOOP;
      DELETE FROM studenci
      WHERE
      id=sid;
      delete from osoby
      where id=sid;
   END;
/
CREATE or replace PROCEDURE usungrupe (gid grupy.id%type) as
   BEGIN
        FOR c IN (SELECT id FROM studenci where grupa_id=gid) LOOP
           usunosobe(c.id);
        END LOOP;
      DELETE FROM grupy
      WHERE
      id=gid;
   END;
/
CREATE or replace PROCEDURE usunprzedmiot (pid przedmioty.id%type) as
   BEGIN
       delete from oceny where zajecia_id in (select id from zajecia where przedmiot_id=pid);
       delete from zajecia_w_planie where zajecia_id in (select id from zajecia where przedmiot_id=pid);
       delete from zajecia where przedmiot_id=pid;
       delete from przedmioty where id=pid;
   END;
/
CREATE or replace PROCEDURE usunkierunek (kid kierunki.id%type) as
   BEGIN
        FOR c IN (SELECT id FROM przedmioty where semestr_id in (select id from semestry where kierunek_id=kid)) LOOP
           usunprzedmiot(c.id);
        END LOOP;
        FOR c IN (SELECT id FROM grupy where semestr_id in (select id from semestry where kierunek_id=kid)) LOOP
           usungrupe(c.id);
        END LOOP;
      DELETE FROM semestry
      WHERE
      kierunek_id=kid;
      delete from kierunki where id=kid;
   END;
/
CREATE or replace PROCEDURE usunwydzial (wid wydzialy.id%type) as
   BEGIN
        FOR c IN (SELECT id FROM kierunki where wydzial_id=wid) LOOP
           usunkierunek(c.id);
        END LOOP;
      delete from wydzialy where id=wid;
   END;
/
CREATE or replace PROCEDURE usunpracownika (pid pracownicy.id%type) as
   BEGIN
        delete from zajecia_w_planie where pracownik_id=pid;
        delete from oceny where pracownik_id=pid;
      delete from pracownicy where id=pid;
      delete from osoby where id=pid;
   END;
/
CREATE or replace PROCEDURE usunzespol (zid zespoly.id%type) as
   BEGIN
        FOR c IN (SELECT id FROM pracownicy where zespol_id=zid) LOOP
           usunpracownika(c.id);
        END LOOP;
      delete from zespoly where id=zid;
   END;
/

-- Oracle SQL Developer Data Modeler Summary Report: 
-- 
-- CREATE TABLE                            14
-- CREATE INDEX                             0
-- ALTER TABLE                             58
-- CREATE VIEW                              0
-- ALTER VIEW                               0
-- CREATE PACKAGE                           0
-- CREATE PACKAGE BODY                      0
-- CREATE PROCEDURE                         0
-- CREATE FUNCTION                          0
-- CREATE TRIGGER                          11
-- ALTER TRIGGER                            0
-- CREATE COLLECTION TYPE                   0
-- CREATE STRUCTURED TYPE                   0
-- CREATE STRUCTURED TYPE BODY              0
-- CREATE CLUSTER                           0
-- CREATE CONTEXT                           0
-- CREATE DATABASE                          0
-- CREATE DIMENSION                         0
-- CREATE DIRECTORY                         0
-- CREATE DISK GROUP                        0
-- CREATE ROLE                              0
-- CREATE ROLLBACK SEGMENT                  0
-- CREATE SEQUENCE                          9
-- CREATE MATERIALIZED VIEW                 0
-- CREATE MATERIALIZED VIEW LOG             0
-- CREATE SYNONYM                           0
-- CREATE TABLESPACE                        0
-- CREATE USER                              0
-- 
-- DROP TABLESPACE                          0
-- DROP DATABASE                            0
-- 
-- REDACTION POLICY                         0
-- 
-- ORDS DROP SCHEMA                         0
-- ORDS ENABLE SCHEMA                       0
-- ORDS ENABLE OBJECT                       0
-- 
-- ERRORS                                   0
-- WARNINGS                                 0
